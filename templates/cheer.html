<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>G-STEPS开业啦！</title>
    <meta name="description" content="一个连程序猿都会Hip-Hop的街舞社团，来瞧瞧我们的另一面！" />
    <link rel="stylesheet" href="static/css/layer.css">
    <link rel="stylesheet" href="static/css/main.css?v=11">
    <!-- <link rel="stylesheet" href="static/css/count.css"> -->

</head>
<body>
<img src="static/img/gsteps_logo.png" style="width:0px; height:0px; overflow:hidden; position: absolute;"  alt="">

<div id="formbackground" style="position:absolute; width:100%; height:100%; z-index:-1">
    <img src="static/img/cheerbg.png" height="100%" width="100%"/>
</div>

<div class="info">
    <a href="javascript:;"><img src="static/img/info.png" alt=""></a>
</div>
<div class="title-wrap">
   <!-- <img src="static/img/title1.png" class="title1">
   <img src="static/img/title2.png" class="title2"> -->
</div>

<div class="ticket-wrapper">
    <div class="ticket_img_wrapper">
        {% if remain_cheer_num<=0%}
        <img src="static/img/red_bg.png" class="ticket" alt="">
        <div class="float_area">
            <img src="static/img/700.png" class="ticket gsteps_six" alt="">
            <ul class="wrapper_heart">
                <li class="heart">
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                </li>
                <li class="heart">
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                    <image class="image_heart" src="static/img/choose_heart.png"></image>
                </li>
            </ul>
            <div class="remain_num">
                <img src="static/img/gsteps_friends_success.png" class="ticket gsteps_person_last" alt="">
            </div>
        </div>
        {% elif  remain_cheer_num<=16 %}
        <img src="static/img/red_bg.png" class="ticket" alt="">
        <div class="float_area">
            <img src="static/img/700.png" class="ticket gsteps_six" alt="">
            <ul class="wrapper_heart">
                <li class="heart">
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                </li>
                <li class="heart">
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                    <image class="image_heart" src="static/img/unchoose_heart.png"></image>
                </li>
            </ul>
            <div class="remain_num">
                <img src="static/img/gsteps_person_last.png" class="ticket gsteps_person_last" alt="">
                <div class="exchange-wrapper">
                    <p>你的盆友还差<span class="remain_cheer_num">{{ remain_cheer_num }}</span>人加油即可兑换</p>
                </div>
            </div>
        </div>
        {% endif%}


    </div>
</div>

<div class="button-wrapper">
    {% if remain_cheer_num<=0%}
        <a href="/activity" class="btn btn-help friend-success"><img class="iwant" src="static/img/iwant.png" alt=""></a>
        <!-- <p class="want-tips" style="display:none">发送给盆友的方法：点击右上角分享，你懂的!</p> -->
    {% elif  remain_cheer_num<=16 %}
         <a class="btn btn-cheerup" href="javascript:;" onclick="cheer('{{ union_id }}', '{{ target_union_id }}')">
            <img src="static/img/cheer.png" alt="">
        </a>
         <a href="/activity" class="btn btn-help"><img class="iwant" src="static/img/iwant.png" alt=""></a>
        <!-- <p class="want-tips" style="display:none">发送给盆友的方法：点击右上角分享，你懂的!</p> -->
    {% endif%}


    <!-- <button class="btn btn-help">让盆友帮忙兑票</button> -->
</div>

<script type="text/javascript" src="{{ url_for('static', filename='js/jquery.js') }}"></script>
<script src="static/js/main.js?v=3"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
$.ajax({
  url: "/conf_menu_share",
  type: "GET",
  dataType: "json",
  data: {
    current_page_url: window.location.href
  },
  success: function(data) {
        var config = {
            debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
    appId: data.appid, // 必填，公众号的唯一标识
    timestamp: data.timestamp, // 必填，生成签名的时间戳
    nonceStr: data.noncestr, // 必填，生成签名的随机串
    signature: data.signature,// 必填，签名，见附录1
    jsApiList: data.js_api_list// 必填，需要使用的JS接口列表，所有JS接口列表见附录2
         }

        console.log(config);
      wx.config(config);
      wx.ready(function () {
wx.onMenuShareTimeline({
    title: '一个让你变得更COOL的方法！请认真对待!', // 分享标题
    link: data.link, // 分享链接
    imgUrl: "http://" + location.host + '/static/img/gsteps_logo.png', // 分享图标
    success: function () {
        // 用户确认分享后执行的回调函数
    },
    cancel: function () {
        // 用户取消分享后执行的回调函数
    }
});

  wx.onMenuShareAppMessage({
      title: '一个让你变得更COOL的方法！请认真对待！',
      desc: 'GSTEPS专注零基础起步的上班族！给你体验另外一种更Cool的生活方式！',
      link: data.link,
      imgUrl: "http://" + location.host + '/static/img/gsteps_logo.png',
      trigger: function (res) {
      },
      success: function (res) {
      },
      cancel: function (res) {
      },
      fail: function (res) {
        alert(JSON.stringify(res));
      }
    });
      })
  }
})
</script>

<script>
    var zan, repeat;
    var image_heart = $(".image_heart");
    var num = 16 - parseInt($(".remain_cheer_num").text());
    if (num > 0) {
        image_heart.filter(":lt("+ num +")").attr("src", "static/img/choose_heart.png");
    }

    $(document).on("click", '.zan_make', function() {
        layer.close(zan)
    })

    $(document).on("click", '.repeat_make', function() {
        layer.close(repeat)
    })
    // $(".btn-help").on('click', function(){
    //     $(".want-tips").show();
    // })
    function cheer(union_id, target_union_id) {
        var data = {"union_id": union_id, 'target_union_id': target_union_id};
        $.ajax({
            url: '/async_cheer',
            dataType: "json",
            async: true,
            data: data,
            type: "POST",
            success: function (req) {
                if (req.code == 1) {
                    layer.open({
                        title: [
                        '360G-STEPS公演入场票兑换',
                        'background-color:#182f52; color:#fff;'
                        ],
                        content:'<h3 class="layer-con-title">恭喜您已经成功加油</h3><p>帮助您的朋友在兑票的道路上迈出重要一步！</p>',
                        btn:['确定']
                    })

                    var num = 16 - req.target_remain_cheer_num;

                    if(num == 0) {
                        $(".exchange-wrapper p").html("您的朋友已经成功获取入场票");
                    } else {
                        image_heart.eq(num-1).attr("src", "static/img/choose_heart.png");
                        $(".remain_cheer_num").text(req.target_remain_cheer_num)
                        zan = layer.open({
                        content:"<div class='zan_wrapper'><img src='/static/img/zan-success1.png' style='width: 100%'></img><img src='/static/img/make_sure.png' class='zan_make'></img>"
                        })
                    }

                } else if (req.code == 5){

                    repeat = layer.open({
                        content:"<div class='repeat_wrapper'><img src='/static/img/repeat.png' style='width: 100%'></img><img src='/static/img/make_sure.png' class='repeat_make'></img>"
                        })
                    // layer.open({
                    //     title: [
                    //     '360G-STEPS公演入场票兑换',
                    //     'background-color:#182f52; color:#fff;'
                    //     ],
                    //     content:'<p>您之前已经成功加油，不能重复哦！</p>',
                    //     btn:['确定']
                    // })
                } else{
                    layer.open({
                        title: [
                        '360G-STEPS公演入场票兑换',
                        'background-color:#182f52; color:#fff;'
                        ],
                        content:"加油失败:错误码" + req.code,
                        btn:['确定']
                    })
                }

            }
        });

    }
</script>
</body>
</html>
